function _log(n){var t=(new Date).toString();$("#__log").prepend("<h6>"+t+" - "+n+"</h6>")}function updateBlocklist(n){var t=store.smembers("blocklist");return t&&t.length?(_log("getting blocklist"),void async.eachSeries(t,function(n,t){getTweets(n,function(n,e){var r=0;e.forEach(function(n){var t=n.trim().split(" ");t.forEach(function(n){r+=store.sadd("blocklist:users",n)})}),_log("updated blocklist with "+r+" new users"),t()})},n)):_log("no blocklist found")}function getTweets(n,t){var e,r=[],i=0;async.doWhilst(function(t){_log("getting tweets "+ ++i);var o={};e&&(o.contextual_tweet_id=e,o.max_id=e),$.getJSON("/i/profiles/show/"+n+"/timeline",o,function(n){if(""!=n.inner.items_html){var i=$(n.inner.items_html);e=i.find(".js-stream-item:last").attr("data-item-id"),console.dir(i),r.push(n.inner.items_html)}else e=void 0;t()})},function(){return void 0!=e},function(){var n=[];cleanTweets(r).forEach(function(t){n=n.concat(t)}),t(null,n)})}function getFollowers(n,t){var e=[],r=0;async.doWhilst(function(t){_log("getting followers "+ ++r);var i={};cursor&&(i.cursor=cursor),$.getJSON("/"+n+"/followers/users",i,function(n){cursor="0"==n.cursor?void 0:n.cursor,e.push(n.items_html),t()})},function(){return void 0!=cursor},function(){var n=[];cleanFollowers(e).forEach(function(t){n=n.concat(t)}),t(null,n)})}function getFollowing(n,t){var e=[],r=0;async.doWhilst(function(t){_log("getting following "+ ++r);var i={};cursor&&(i.cursor=cursor),$.getJSON("/"+n+"/following/users",i,function(n){cursor="0"==n.cursor?void 0:n.cursor,e.push(n.items_html),t()})},function(){return void 0!=cursor},function(){var n=[];cleanFollowers(e).forEach(function(t){n=n.concat(t)}),t(null,n)})}function cleanTweets(n){var t=n.join("");t=$("<div>"+t+"</div>");var e=t.find(".ProfileTweet-text").map(function(){return $(this).text()}).toArray();return e}function cleanFollowers(n){var t=n.join("");t=$("<div>"+t+"</div>");var e=t.find(".u-linkComplex-target").map(function(){return $(this).text()}).toArray();return e}function tweet(n,t){$.post("/i/tweet/create",{status:n,authenticity_token:$("input[name='authenticity_token']").val()}).always(t)}function block(n,t){store.sadd("blocked",n),$.post("/i/user/block",{block_user:"true",authenticity_token:$("input[name='authenticity_token']").val(),screen_name:n}).always(t)}function isBlocked(n){return store.sismember("blocked",n)}function me(){return JSON.parse($("#init-data").val()).screenName}function myAccounts(){return store.keys().filter(function(n){return-1!=n.indexOf("myaccount")})}function msgHasRoomForMore(n,t){return(n+" "+t).length<140}function backupAccount(){var n=store.get("myaccount:"+me());downloadJSON(n,"data."+me())}function downloadJSON(n,t){var n=JSON.stringify(n,!1,3),e=document.createElement("a");e.href="data:attachment/json;charset=utf-8,"+encodeURIComponent(n),e.target="_blank",e.download=t+".json",document.body.appendChild(e),e.click()}!function(){function n(n){var e=!1;return function(){if(e)throw new Error("Callback was already called.");e=!0,n.apply(t,arguments)}}var t,e,r={};t=this,null!=t&&(e=t.async),r.noConflict=function(){return t.async=e,r};var i=Object.prototype.toString,o=Array.isArray||function(n){return"[object Array]"===i.call(n)},a=function(n,t){if(n.forEach)return n.forEach(t);for(var e=0;e<n.length;e+=1)t(n[e],e,n)},u=function(n,t){if(n.map)return n.map(t);var e=[];return a(n,function(n,r,i){e.push(t(n,r,i))}),e},s=function(n,t,e){return n.reduce?n.reduce(t,e):(a(n,function(n,r,i){e=t(e,n,r,i)}),e)},c=function(n){if(Object.keys)return Object.keys(n);var t=[];for(var e in n)n.hasOwnProperty(e)&&t.push(e);return t};"undefined"!=typeof process&&process.nextTick?(r.nextTick=process.nextTick,r.setImmediate="undefined"!=typeof setImmediate?function(n){setImmediate(n)}:r.nextTick):"function"==typeof setImmediate?(r.nextTick=function(n){setImmediate(n)},r.setImmediate=r.nextTick):(r.nextTick=function(n){setTimeout(n,0)},r.setImmediate=r.nextTick),r.each=function(t,e,r){function i(n){n?(r(n),r=function(){}):(o+=1,o>=t.length&&r())}if(r=r||function(){},!t.length)return r();var o=0;a(t,function(t){e(t,n(i))})},r.forEach=r.each,r.eachSeries=function(n,t,e){if(e=e||function(){},!n.length)return e();var r=0,i=function(){t(n[r],function(t){t?(e(t),e=function(){}):(r+=1,r>=n.length?e():i())})};i()},r.forEachSeries=r.eachSeries,r.eachLimit=function(n,t,e,r){var i=l(t);i.apply(null,[n,e,r])},r.forEachLimit=r.eachLimit;var l=function(n){return function(t,e,r){if(r=r||function(){},!t.length||0>=n)return r();var i=0,o=0,a=0;!function u(){if(i>=t.length)return r();for(;n>a&&o<t.length;)o+=1,a+=1,e(t[o-1],function(n){n?(r(n),r=function(){}):(i+=1,a-=1,i>=t.length?r():u())})}()}},f=function(n){return function(){var t=Array.prototype.slice.call(arguments);return n.apply(null,[r.each].concat(t))}},p=function(n,t){return function(){var e=Array.prototype.slice.call(arguments);return t.apply(null,[l(n)].concat(e))}},d=function(n){return function(){var t=Array.prototype.slice.call(arguments);return n.apply(null,[r.eachSeries].concat(t))}},h=function(n,t,e,r){if(t=u(t,function(n,t){return{index:t,value:n}}),r){var i=[];n(t,function(n,t){e(n.value,function(e,r){i[n.index]=r,t(e)})},function(n){r(n,i)})}else n(t,function(n,t){e(n.value,function(n){t(n)})})};r.map=f(h),r.mapSeries=d(h),r.mapLimit=function(n,t,e,r){return m(t)(n,e,r)};var m=function(n){return p(n,h)};r.reduce=function(n,t,e,i){r.eachSeries(n,function(n,r){e(t,n,function(n,e){t=e,r(n)})},function(n){i(n,t)})},r.inject=r.reduce,r.foldl=r.reduce,r.reduceRight=function(n,t,e,i){var o=u(n,function(n){return n}).reverse();r.reduce(o,t,e,i)},r.foldr=r.reduceRight;var g=function(n,t,e,r){var i=[];t=u(t,function(n,t){return{index:t,value:n}}),n(t,function(n,t){e(n.value,function(e){e&&i.push(n),t()})},function(){r(u(i.sort(function(n,t){return n.index-t.index}),function(n){return n.value}))})};r.filter=f(g),r.filterSeries=d(g),r.select=r.filter,r.selectSeries=r.filterSeries;var v=function(n,t,e,r){var i=[];t=u(t,function(n,t){return{index:t,value:n}}),n(t,function(n,t){e(n.value,function(e){e||i.push(n),t()})},function(){r(u(i.sort(function(n,t){return n.index-t.index}),function(n){return n.value}))})};r.reject=f(v),r.rejectSeries=d(v);var y=function(n,t,e,r){n(t,function(n,t){e(n,function(e){e?(r(n),r=function(){}):t()})},function(){r()})};r.detect=f(y),r.detectSeries=d(y),r.some=function(n,t,e){r.each(n,function(n,r){t(n,function(n){n&&(e(!0),e=function(){}),r()})},function(){e(!1)})},r.any=r.some,r.every=function(n,t,e){r.each(n,function(n,r){t(n,function(n){n||(e(!1),e=function(){}),r()})},function(){e(!0)})},r.all=r.every,r.sortBy=function(n,t,e){r.map(n,function(n,e){t(n,function(t,r){t?e(t):e(null,{value:n,criteria:r})})},function(n,t){if(n)return e(n);var r=function(n,t){var e=n.criteria,r=t.criteria;return r>e?-1:e>r?1:0};e(null,u(t.sort(r),function(n){return n.value}))})},r.auto=function(n,t){t=t||function(){};var e=c(n),i=e.length;if(!i)return t();var u={},l=[],f=function(n){l.unshift(n)},p=function(n){for(var t=0;t<l.length;t+=1)if(l[t]===n)return void l.splice(t,1)},d=function(){i--,a(l.slice(0),function(n){n()})};f(function(){if(!i){var n=t;t=function(){},n(null,u)}}),a(e,function(e){var i=o(n[e])?n[e]:[n[e]],l=function(n){var i=Array.prototype.slice.call(arguments,1);if(i.length<=1&&(i=i[0]),n){var o={};a(c(u),function(n){o[n]=u[n]}),o[e]=i,t(n,o),t=function(){}}else u[e]=i,r.setImmediate(d)},h=i.slice(0,Math.abs(i.length-1))||[],m=function(){return s(h,function(n,t){return n&&u.hasOwnProperty(t)},!0)&&!u.hasOwnProperty(e)};if(m())i[i.length-1](l,u);else{var g=function(){m()&&(p(g),i[i.length-1](l,u))};f(g)}})},r.retry=function(n,t,e){var i=5,o=[];"function"==typeof n&&(e=t,t=n,n=i),n=parseInt(n,10)||i;var a=function(i,a){for(var u=function(n,t){return function(e){n(function(n,r){e(!n||t,{err:n,result:r})},a)}};n;)o.push(u(t,!(n-=1)));r.series(o,function(n,t){t=t[t.length-1],(i||e)(t.err,t.result)})};return e?a():a},r.waterfall=function(n,t){if(t=t||function(){},!o(n)){var e=new Error("First argument to waterfall must be an array of functions");return t(e)}if(!n.length)return t();var i=function(n){return function(e){if(e)t.apply(null,arguments),t=function(){};else{var o=Array.prototype.slice.call(arguments,1),a=n.next();o.push(a?i(a):t),r.setImmediate(function(){n.apply(null,o)})}}};i(r.iterator(n))()};var w=function(n,t,e){if(e=e||function(){},o(t))n.map(t,function(n,t){n&&n(function(n){var e=Array.prototype.slice.call(arguments,1);e.length<=1&&(e=e[0]),t.call(null,n,e)})},e);else{var r={};n.each(c(t),function(n,e){t[n](function(t){var i=Array.prototype.slice.call(arguments,1);i.length<=1&&(i=i[0]),r[n]=i,e(t)})},function(n){e(n,r)})}};r.parallel=function(n,t){w({map:r.map,each:r.each},n,t)},r.parallelLimit=function(n,t,e){w({map:m(t),each:l(t)},n,e)},r.series=function(n,t){if(t=t||function(){},o(n))r.mapSeries(n,function(n,t){n&&n(function(n){var e=Array.prototype.slice.call(arguments,1);e.length<=1&&(e=e[0]),t.call(null,n,e)})},t);else{var e={};r.eachSeries(c(n),function(t,r){n[t](function(n){var i=Array.prototype.slice.call(arguments,1);i.length<=1&&(i=i[0]),e[t]=i,r(n)})},function(n){t(n,e)})}},r.iterator=function(n){var t=function(e){var r=function(){return n.length&&n[e].apply(null,arguments),r.next()};return r.next=function(){return e<n.length-1?t(e+1):null},r};return t(0)},r.apply=function(n){var t=Array.prototype.slice.call(arguments,1);return function(){return n.apply(null,t.concat(Array.prototype.slice.call(arguments)))}};var b=function(n,t,e,r){var i=[];n(t,function(n,t){e(n,function(n,e){i=i.concat(e||[]),t(n)})},function(n){r(n,i)})};r.concat=f(b),r.concatSeries=d(b),r.whilst=function(n,t,e){n()?t(function(i){return i?e(i):void r.whilst(n,t,e)}):e()},r.doWhilst=function(n,t,e){n(function(i){if(i)return e(i);var o=Array.prototype.slice.call(arguments,1);t.apply(null,o)?r.doWhilst(n,t,e):e()})},r.until=function(n,t,e){n()?e():t(function(i){return i?e(i):void r.until(n,t,e)})},r.doUntil=function(n,t,e){n(function(i){if(i)return e(i);var o=Array.prototype.slice.call(arguments,1);t.apply(null,o)?e():r.doUntil(n,t,e)})},r.queue=function(t,e){function i(n,t,e,i){return n.started||(n.started=!0),o(t)||(t=[t]),0==t.length?r.setImmediate(function(){n.drain&&n.drain()}):void a(t,function(t){var o={data:t,callback:"function"==typeof i?i:null};e?n.tasks.unshift(o):n.tasks.push(o),n.saturated&&n.tasks.length===n.concurrency&&n.saturated(),r.setImmediate(n.process)})}void 0===e&&(e=1);var u=0,s={tasks:[],concurrency:e,saturated:null,empty:null,drain:null,started:!1,paused:!1,push:function(n,t){i(s,n,!1,t)},kill:function(){s.drain=null,s.tasks=[]},unshift:function(n,t){i(s,n,!0,t)},process:function(){if(!s.paused&&u<s.concurrency&&s.tasks.length){var e=s.tasks.shift();s.empty&&0===s.tasks.length&&s.empty(),u+=1;var r=function(){u-=1,e.callback&&e.callback.apply(e,arguments),s.drain&&s.tasks.length+u===0&&s.drain(),s.process()},i=n(r);t(e.data,i)}},length:function(){return s.tasks.length},running:function(){return u},idle:function(){return s.tasks.length+u===0},pause:function(){s.paused!==!0&&(s.paused=!0,s.process())},resume:function(){s.paused!==!1&&(s.paused=!1,s.process())}};return s},r.priorityQueue=function(n,t){function e(n,t){return n.priority-t.priority}function i(n,t,e){for(var r=-1,i=n.length-1;i>r;){var o=r+(i-r+1>>>1);e(t,n[o])>=0?r=o:i=o-1}return r}function u(n,t,u,s){return n.started||(n.started=!0),o(t)||(t=[t]),0==t.length?r.setImmediate(function(){n.drain&&n.drain()}):void a(t,function(t){var o={data:t,priority:u,callback:"function"==typeof s?s:null};n.tasks.splice(i(n.tasks,o,e)+1,0,o),n.saturated&&n.tasks.length===n.concurrency&&n.saturated(),r.setImmediate(n.process)})}var s=r.queue(n,t);return s.push=function(n,t,e){u(s,n,t,e)},delete s.unshift,s},r.cargo=function(n,t){var e=!1,i=[],s={tasks:i,payload:t,saturated:null,empty:null,drain:null,drained:!0,push:function(n,e){o(n)||(n=[n]),a(n,function(n){i.push({data:n,callback:"function"==typeof e?e:null}),s.drained=!1,s.saturated&&i.length===t&&s.saturated()}),r.setImmediate(s.process)},process:function c(){if(!e){if(0===i.length)return s.drain&&!s.drained&&s.drain(),void(s.drained=!0);var r="number"==typeof t?i.splice(0,t):i.splice(0,i.length),o=u(r,function(n){return n.data});s.empty&&s.empty(),e=!0,n(o,function(){e=!1;var n=arguments;a(r,function(t){t.callback&&t.callback.apply(null,n)}),c()})}},length:function(){return i.length},running:function(){return e}};return s};var k=function(n){return function(t){var e=Array.prototype.slice.call(arguments,1);t.apply(null,e.concat([function(t){var e=Array.prototype.slice.call(arguments,1);"undefined"!=typeof console&&(t?console.error&&console.error(t):console[n]&&a(e,function(t){console[n](t)}))}]))}};r.log=k("log"),r.dir=k("dir"),r.memoize=function(n,t){var e={},i={};t=t||function(n){return n};var o=function(){var o=Array.prototype.slice.call(arguments),a=o.pop(),u=t.apply(null,o);u in e?r.nextTick(function(){a.apply(null,e[u])}):u in i?i[u].push(a):(i[u]=[a],n.apply(null,o.concat([function(){e[u]=arguments;var n=i[u];delete i[u];for(var t=0,r=n.length;r>t;t++)n[t].apply(null,arguments)}])))};return o.memo=e,o.unmemoized=n,o},r.unmemoize=function(n){return function(){return(n.unmemoized||n).apply(null,arguments)}},r.times=function(n,t,e){for(var i=[],o=0;n>o;o++)i.push(o);return r.map(i,t,e)},r.timesSeries=function(n,t,e){for(var i=[],o=0;n>o;o++)i.push(o);return r.mapSeries(i,t,e)},r.seq=function(){var n=arguments;return function(){var t=this,e=Array.prototype.slice.call(arguments),i=e.pop();r.reduce(n,e,function(n,e,r){e.apply(t,n.concat([function(){var n=arguments[0],t=Array.prototype.slice.call(arguments,1);r(n,t)}]))},function(n,e){i.apply(t,[n].concat(e))})}},r.compose=function(){return r.seq.apply(null,Array.prototype.reverse.call(arguments))};var _=function(n,t){var e=function(){var e=this,r=Array.prototype.slice.call(arguments),i=r.pop();return n(t,function(n,t){n.apply(e,r.concat([t]))},i)};if(arguments.length>2){var r=Array.prototype.slice.call(arguments,2);return e.apply(this,r)}return e};r.applyEach=f(_),r.applyEachSeries=d(_),r.forever=function(n,t){function e(r){if(r){if(t)return t(r);throw r}n(e)}e()},"undefined"!=typeof module&&module.exports?module.exports=r:"undefined"!=typeof define&&define.amd?define([],function(){return r}):t.async=r}(),function(n){"undefined"==typeof window&&(window={}),"undefined"==typeof window.localStorage&&n!==window&&(window.localStorage={},window.localStorage.store={},window.localStorage.setItem=function(n,t){window.localStorage.store[n]=t},window.localStorage.getItem=function(n){var t;return t=window.localStorage.store[n],void 0===t?null:t},window.localStorage.removeItem=function(n){delete window.localStorage.store[n]},window.localStorage.clear=function(){window.localStorage.store={}});var t=function(n,t,e){var r=n.slice((e||t)+1||n.length);return n.length=0>t?n.length+t:t,n.push.apply(n,r)},e=function(n,e){if(isNaN(parseInt(n,10)))throw new r("db index must be an integer");n=parseInt(n,10),e=e||{};var u=this,s=n,c=e.adapter;void 0===c?c=new o:null===c&&(c=new a);var l="bb:"+s.toString()+":",f="bb:"+s.toString()+"k:___keys___",p={};if(this.toString=function(){return"bb:"+s.toString()},"undefined"==typeof JSON&&!(window.JSON&&window.JSON.parse&&window.JSON.stringify))throw"No JSON support detected. Please include a JSON module with 'parse' and 'stringify' functions.";var d=function(n){var t=p[n]||c.getItem(n);return t?!0:!1},h=function(n){var t=p[n];if(void 0!==t)return t;t=c.getItem(n);var e=t;try{e=JSON.parse(t)}catch(r){}finally{p[n]=e}return e},m=function(n,t){p[n]=t,c.storeItem(n,JSON.stringify(t))},g=function(n){delete p[n],c.removeItem(n)},v=function(n,t){var e=h(n,t);return null===e?null:e.v},y=function(n,t,e){var r=h(n,e);return null===r?null:r.m[t]},w=function(n,t,e){var r=h(n,e);(void 0===r||null===r)&&(r={},r.m={}),r.v=t,void 0!==e&&(r.m.t=e),m(n,r,e)},b=function(n,t,e){var r=p[n];void 0!==r&&null!==r&&(r.m[t]=e,m(n,r))},k=function(n){return d(l+n)},_=function(n,t,e){w(l+n,t,e),void 0!==e&&I(n,e),N[n]=1,w(f,N,"set")},x=function(n,t){return v(l+n,t)},S=function(n){g(l+n),delete N[n],w(f,N,"set")},A=function(n,t,e){b(l+n,t,e)},j=function(n,t){return y(l+n,t)},I=function(n,t){A(n,"t",t)},O=function(n){return j(n,"t")},B=function(n,t){var e=u.type(n),o={};if(o.get="string",o.set="string",o.strlen="string",o.setnx="string",o.append="string",o.incr="string",o.incrby="string",o.getset="string",o.lpush="list",o.lpushx="list",o.lpop="list",o.rpush="list",o.rpushx="list",o.rpop="list",o.rpoplpush="list",o.llen="list",o.lindex="list",o.lrange="list",o.lrem="list",o.lset="list",o.ltrim="list",o.sadd="set",o.scard="set",o.sismember="set",o.smembers="set",o.srem="set",o.smove="set",o.spop="set",o.srandmember="set",void 0===o[t])throw new r("unknown key operation in validate_key");if(void 0===e||null===e||void 0===o[t]||o[t]==e)return!0;throw new i("invalid operation on key type: "+e)};this.del=function(n){var t=0;return x(n)&&(t=1),S(n),t},this.exists=function(n){return k(n)},this.type=function(n){return O(n)},this.get=function(n){return B(n,"get"),x(n)},this.getset=function(n,t){B(n,"getset");var e=u.get(n);return u.set(n,t),e},this.append=function(n,t){B(n,"append");var e=u.get(n);return null!==e?(u.set(n,e+t),(e+t).length):(u.set(n,t),t.toString().length)},this.decr=function(n){return u.incrby(n,-1)},this.decrby=function(n,t){return u.incrby(n,0-t)},this.incr=function(n){return u.incrby(n,1)},this.incrby=function(n,t){B(n,"incrby");var e=u.get(n);if(null!==e){if(isNaN(parseInt(e,10)))throw new i("key is not parsable as an integer");return u.set(n,e+t),e+t}return u.set(n,t),t},this.set=function(n,t){return B(n,"set"),_(n,t),I(n,"string"),"OK"},this.setnx=function(n,t){B(n,"setnx");var e=u.get(n);return null!==e?0:(u.set(n,t),1)},this.strlen=function(n){B(n,"strlen");var t=u.get(n);return null!==t?t.toString().length:0},this.llen=function(n){B(n,"llen");var t=x(n,"list");return null===t?0:t.length},this.lindex=function(n,t){B(n,"lindex");var e=x(n,"list");if(null!==e){0>t&&(t=e.length+t);var r=e[t];return void 0===r&&(r=null),r}return null},this.lpop=function(n){B(n,"lpop");var t=x(n,"list");if(null===t)return null;var e=t.shift();return 0===t.length?u.del(n):_(n,t,"list"),e},this.lpush=function(n,t){B(n,"lpush");var e=x(n,"list");return null===e&&(e=[]),e.unshift(t),_(n,e,"list"),e.length},this.lpushx=function(n,t){B(n,"lpushx");var e=x(n,"list");return null!==e?u.lpush(n,t):0},this.lrange=function(n,t,e){B(n,"lrange");var r=x(n,"list");return null===r?[]:-1===e?r.slice(t):r.slice(t,e+1)},this.lrem=function(n,e,r){B(n,"lrem");var i=x(n,"list");if(null===i)return 0;for(var o=0,a=[],s=0;s<i.length;s++)i[s]==r&&(a.push(s),o++);for(e>0?a=a.slice(0,e):0>e&&(a=a.slice(e));a.length;){var c=a.pop();t(i,c)}return 0===i.length?u.del(n):_(n,i,"list"),0==e?o:Math.min(o,Math.abs(e))},this.lset=function(n,t,e){B(n,"lset");var o=x(n,"list");if(null===o)throw new i("no such key");if(0>t&&(t=o.length+t),0>t||t>=o.length)throw new r("index out of range");return o[t]=e,_(n,o,"list"),"OK"},this.ltrim=function(n,t,e){B(n,"ltrim");var r=x(n,"list");return null===r?"OK":(r=-1===e?r.slice(t):r.slice(t,e+1),0===r.length?u.del(n):_(n,r,"list"),"OK")},this.rpop=function(n){B(n,"rpop");var t=x(n,"list");if(null===t)return null;var e=t.pop();return 0===t.length?u.del(n):_(n,t,"list"),e},this.rpush=function(n,t){B(n,"rpush");var e=x(n);return null===e&&(e=[]),e.push(t),_(n,e,"list"),e.length},this.rpushx=function(n,t){B(n,"rpushx");var e=x(n,"list");return null!==e?u.rpush(n,t):0},this.rpoplpush=function(n,t){B(n,"rpoplpush"),B(t,"rpoplpush");{var e=x(n,"list");x(t,"list")}if(null===e)return null;var r=u.rpop(n);return u.lpush(t,r),r},this.sadd=function(n,t){B(n,"sadd");var e,r=x(n,"set"),i=0;return null===r?(r={},e=0):e=parseInt(j(n,"card"),10),1!==r[t]&&(i=1,e+=1),r[t]=1,_(n,r,"set"),A(n,"card",e),i},this.scard=function(n){return B(n,"scard"),u.exists(n)?parseInt(j(n,"card"),10):0},this.sismember=function(n,t){B(n,"sismember");var e=x(n,"set");return null===e?!1:1===e[t]?!0:!1},this.smembers=function(n){B(n,"smembers");var t=x(n,"set");if(null===t)return[];var e=[];for(var r in t)t.hasOwnProperty(r)&&e.push(r);return e},this.smove=function(n,t,e){B(n,"smove"),B(t,"smove");var r=x(n,"set");if(null===r)return 0;var i=u.srem(n,e);return i&&u.sadd(t,e),i},this.spop=function(n){B(n,"spop");var t=u.srandmember(n);return null!==t&&u.srem(n,t),t},this.srandmember=function(n){B(n,"srandmember");var t=x(n,"set");if(null===t)return null;var e=u.smembers(n),r=Math.floor(Math.random()*e.length),i=e[r];return i},this.srem=function(n,t){B(n,"srem");var e=x(n,"set");if(null===e)return 0;var r=0;if(1===e[t]){r=1,delete e[t];var i=parseInt(j(n,"card"),10)-1;0===i?u.del(n):(_(n,e,"set"),A(n,"card",i))}return r},this.keys=function(){var n=[];for(var t in N)N.hasOwnProperty(t)&&n.push(t);return n},this.flushdb=function(){var n=u.keys("*");for(var t in n)u.del(n[t]);return g(f),"OK"},this.select=function(n){if(isNaN(parseInt(n,10)))throw new r("db index must be an integer");s=n,l="bb:"+n.toString()+":",f="bb:"+n.toString()+"k:___keys___",N=v(f,"set")||{}};var N=v(f,"set")||{}};e.toString=function(){return"[object BankersBox]"};var r=function(n){this.type="BankersBoxException",this.toString=function(){return this.type+": "+n.toString()}},i=function(n){r.call(this,n),this.type="BankersBoxKeyException"},o=function(){if("undefined"==typeof window||"undefined"==typeof window.localStorage)throw"window.localStorage is undefined, consider a different storage adapter";this.getItem=function(n){return window.localStorage.getItem(n)},this.storeItem=function(n,t){try{window.localStorage.setItem(n,t)}catch(e){throw e==QUOTA_EXCEEDED_ERR,e}},this.removeItem=function(n){window.localStorage.removeItem(n)},this.clear=function(){window.localStorage.clear()}},a=function(){this.getItem=function(){return null},this.storeItem=function(){},this.removeItem=function(){},this.clear=function(){}},u=function(n){if("undefined"==typeof module||!module||!module.exports)throw"this does not appear to be a server context, consider a different storage adapter";var t={},e=require("fs"),r=function(){if(e.existsSync(n)){var r=e.readFileSync(n,{encoding:"utf8"});r&&(t=JSON.parse(r))}},i=function(){e.writeFileSync(n,JSON.stringify(t),{encoding:"utf8"})};r(),this.getItem=function(n){return t[n]||null},this.storeItem=function(n,e){t[n]=e,i()},this.removeItem=function(n){delete t[n],i()},this.clear=function(){t={},e.unlinkSync(n)}};n.BankersBox=e,n.BankersBoxException=r,n.BankersBoxKeyException=i,n.BankersBoxLocalStorageAdapter=o,n.BankersBoxNullAdapter=a,n.BankersBoxFileSystemAdapter=u,n!==window&&(n.mock_window=window)}("undefined"!=typeof module&&module&&module.exports?module.exports:window),jade=function(n){function t(n){return null!=n}return Array.isArray||(Array.isArray=function(n){return"[object Array]"==Object.prototype.toString.call(n)}),Object.keys||(Object.keys=function(n){var t=[];for(var e in n)n.hasOwnProperty(e)&&t.push(e);return t}),n.merge=function(n,e){var r=n["class"],i=e["class"];(r||i)&&(r=r||[],i=i||[],Array.isArray(r)||(r=[r]),Array.isArray(i)||(i=[i]),r=r.filter(t),i=i.filter(t),n["class"]=r.concat(i).join(" "));for(var o in e)"class"!=o&&(n[o]=e[o]);return n},n.attrs=function(t,e){var r=[],i=t.terse;delete t.terse;var o=Object.keys(t),a=o.length;if(a){r.push("");for(var u=0;a>u;++u){var s=o[u],c=t[s];"boolean"==typeof c||null==c?c&&r.push(i?s:s+'="'+s+'"'):r.push(0==s.indexOf("data")&&"string"!=typeof c?s+"='"+JSON.stringify(c)+"'":"class"==s&&Array.isArray(c)?s+'="'+n.escape(c.join(" "))+'"':e&&e[s]?s+'="'+n.escape(c)+'"':s+'="'+c+'"')}}return r.join(" ")},n.escape=function(n){return String(n).replace(/&(?!(\w+|\#\d+);)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},n.rethrow=function(n,t,e){if(!t)throw n;var r=3,i=require("fs").readFileSync(t,"utf8"),o=i.split("\n"),a=Math.max(e-r,0),u=Math.min(o.length,e+r),r=o.slice(a,u).map(function(n,t){var r=t+a+1;return(r==e?"  > ":"    ")+r+"| "+n}).join("\n");throw n.path=t,n.message=(t||"Jade")+":"+e+"\n"+r+"\n\n"+n.message,n},n}({}),jade.templates={},jade.render=function(n,t,e){var r=jade.templates[t](e);n.innerHTML=r},jade.templates.backup=function(locals,attrs,escape,rethrow,merge){attrs=attrs||jade.attrs,escape=escape||jade.escape,rethrow=rethrow||jade.rethrow,merge=merge||jade.merge;var buf=[];with(locals||{}){buf.push('<section><section><h1>Create backup</h1><br/><p>This will backup your<strong>followers </strong>and <strong>following </strong></p><br/><section><span class="btn save-data save-browser">Save to browser</span><span class="btn save-data save-computer">Save to computer	</span></section></section></section>')}return buf.join("")},jade.templates.main=function(locals,attrs,escape,rethrow,merge){attrs=attrs||jade.attrs,escape=escape||jade.escape,rethrow=rethrow||jade.rethrow,merge=merge||jade.merge;var buf=[];with(locals||{}){buf.push('<style>#qamar_cont{\n position:fixed;\n top:0;\n left:0;\n width:100%;\n height:100%;\n background:rgba(255,255,255,.95);\n z-index:50000;\n}\n#__log{\n width: 400px;\n height: 100%;\n background: #444;\n padding:10px;\n float:right;\n}\n#__log h6{\n color:#c0c0c0;\n}\n#_menu{\n padding: 10px 10px 10px 0px;\n margin-top:20px;\n}\n#_menu span{\n display:inline-block;\n padding:10px;\n background: #f0f0f0;\n font-size: 20px;\n cursor:pointer;\n}\n#_menu span.active{\n background:rgb(255, 127, 80);		\n}\n._block_user{\n display:inline-block;\n padding:3px;\n background: #f0f0f0;\n margin-right:5px;	\n margin-bottom:5px;	\n}</style><section id="qamar_cont"><section id="__log"></section><section class="Appcontent wrapper wrapper-home"><section><h1>Qamar v0.3</h1><section id="_menu"><span data-type="block list">Block List </span><span data-type="mass tweet">Mass Tweet</span><span data-type="mass follow">Mass Follow</span><span data-type="backup">Backup</span></section><section id="_contents"></section></section></section></section>')}return buf.join("")};var store=new BankersBox(1);jade.render=function(n,t){return t=t||{},jade.templates[n](t)};var announce_account="iSeeKFR";async.waterfall([function(n){_log("loading settings from @"+announce_account),getTweets(announce_account,n)},function(n,t){return n.length?(n.forEach(function(n){var n=n.trim().split(" "),t=n[0],e=n[1];store.sadd(t,e)}),_log("settings updated"),void t()):t("no settings found!")},updateBlocklist]);var _xhr,h=["<br />","<div>","<div><h2>1. Broadcast a tweet to many people</h2></div>","<br /><div><input style='width:310px' id='_username' type='text' placeholder='@Username of the source to get list of followers'></div>","<br /><div><textarea id='_msg' placeholder='Message to broadcast'></textarea></div>","<br /><div><label><input id='_append' type='checkbox'> Append message after mentions</div></label>","<br /><div><button type='button' class='btn' id='_start'>Start</button></div>","<br /><div id='_progress'><div>","</div>"].join(""),main=jade.render("main");$("body").append(main);var cursor;$(function(){$("body").on("click","#__blockall",function(){async.waterfall([function(){async.eachLimit(store.smembers("blocklist:users"),10,function(n,t){return isBlocked(n)?($('[_block_user="'+n+'"]').remove(),t()):void block(n,function(){_log("blocked @"+n),$('._block_user[user="'+n+'"]').remove(),t()})})}])}),$("body").on("click","#_start",function(){async.waterfall([function(n){var t=$("#_username").val();return t&&""!=t?(0==t.indexOf("@")&&(t=t.replace("@","")),_log("getting followers of "+t),void getFollowers(t,n)):alert("invalid username")},function(n,t){_log("got "+n.length+" users"),_log("preparing tweets");for(var e=$("#_msg").val()+"\n\n",r=[],i=0;n.length;){for(var o=new String(e);o.length<140&&n.length;){var a="@"+n[0],u=o+" "+a;if(u.length>140)break;o=u,n.shift()}r.push(o),_log("tweet #"+ ++i+" > "+o)}t(null,r)},function(n,t){var e=0;async.eachSeries(n,function(n,t){_log("tweeting #"+ ++e+" > "+n),tweet(n,function(){t()})},t)}],function(n){return n?_log("ERROR "+n):void 0})}),$("body").on("click","#_menu span",function(){var n=$(this);$("#_menu span").removeClass("active"),n.addClass("active");var t=n.attr("data-type"),e="";if("block list"==t){var r=store.smembers("blocklist:users").map(function(n){return isBlocked(n)?"":'<h6 class="_block_user" user="'+n+'">@'+n+"</h6>"});e=r.join(""),e=e+"<h2>"+store.smembers("blocklist:users").length+" in blocklist, "+store.smembers("blocked").length+" blocked</h2>",e+='<hr /><button type="button" id="__blockall">Block All!</button>'}if("backup"==t){var i=myAccounts();i=i.map(function(n){return n.replace("myaccount:","")}),e=jade.render("backup",{my_accounts:i})}$("#_contents").html(e)}),$("body").on("click",".save-data",function(){var n=$(this).hasClass("save-computer");async.waterfall([function(n){getFollowers(me(),n)},function(n,t){getFollowers(me(),function(e,r){t(null,r,n)})},function(n,t,e){_log("making local backup");var r={};r.following=n,r.followers=t,JSON.stringify(r),store.set("myaccount:"+me(),r),e()}],function(t){return t?_log(t):void(n&&backupAccount())})})});
